<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç³»ç»Ÿé…ç½® - OKX AI åˆ†æç³»ç»Ÿ</title>
<link rel="stylesheet" href="/css/style.css">
</head>
<body>
<nav class="sidebar">
  <div class="sidebar-logo">
    <h1>ğŸ¤– OKX AI<br>åˆ†æç³»ç»Ÿ V2.0</h1>
    <p>ç°è´§æ™ºèƒ½åˆ†æå¹³å°</p>
  </div>
  <div class="nav-menu">
    <a class="nav-item" href="/"><span class="icon">ğŸ“Š</span><span>ä»ªè¡¨ç›˜</span></a>
    <a class="nav-item" href="/accounts.html"><span class="icon">ğŸ‘¤</span><span>è´¦æˆ·ç®¡ç†</span></a>
    <a class="nav-item" href="/analysis.html"><span class="icon">ğŸ§ </span><span>AIåˆ†æ</span></a>
    <a class="nav-item" href="/orders.html"><span class="icon">ğŸ“‹</span><span>äº¤æ˜“è®°å½•</span></a>
    <a class="nav-item" href="/audit.html"><span class="icon">ğŸ”</span><span>å®¡è®¡æ—¥å¿—</span></a>
    <a class="nav-item" href="/monitor.html"><span class="icon">ğŸ–¥ï¸</span><span>ç³»ç»Ÿç›‘æ§</span></a>
    <a class="nav-item" href="/settings.html"><span class="icon">âš™ï¸</span><span>ç³»ç»Ÿé…ç½®</span></a>
  </div>
  <div class="sidebar-footer">
    <button class="btn btn-sm btn-secondary" onclick="logout()">é€€å‡ºç™»å½•</button>
  </div>
</nav>

<main class="main-content">
  <div class="page-header">
    <div>
      <div class="page-title">ç³»ç»Ÿé…ç½®</div>
      <div class="page-subtitle">ç¯å¢ƒå˜é‡ Â· é£æ§è§„åˆ™ Â· é€šçŸ¥è®¾ç½®</div>
    </div>
  </div>

  <!-- ç¯å¢ƒå˜é‡ï¼ˆåªè¯»ï¼‰ -->
  <div class="card">
    <div class="card-title">ç¯å¢ƒå˜é‡ï¼ˆå¯†é’¥å·²éšè—ï¼‰</div>
    <div id="env-config"><div class="loading">åŠ è½½ä¸­...</div></div>
  </div>

  <!-- é£æ§è§„åˆ™ -->
  <div class="card">
    <div class="card-title">é£æ§è§„åˆ™é…ç½®</div>
    <div id="risk-config"><div class="loading">åŠ è½½ä¸­...</div></div>
  </div>

  <!-- é€šçŸ¥é…ç½® -->
  <div class="card">
    <div class="card-title">é€šçŸ¥é…ç½®æµ‹è¯•</div>
    <div class="grid grid-2">
      <div>
        <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px;">æµ‹è¯•é’‰é’‰æœºå™¨äººæ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        <button class="btn btn-secondary" onclick="testNotify('dingtalk')">ğŸ“² æµ‹è¯•é’‰é’‰é€šçŸ¥</button>
      </div>
      <div>
        <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px;">æµ‹è¯• Telegram æœºå™¨äººæ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        <button class="btn btn-secondary" onclick="testNotify('telegram')">âœˆï¸ æµ‹è¯• Telegram é€šçŸ¥</button>
      </div>
    </div>
    <div id="notify-result" style="margin-top:12px;display:none;"></div>
  </div>
</main>

<script src="/js/app.js"></script>
<script>
async function loadConfig() {
  try {
    const data = await apiFetch('/api/config');
    if (!data) return;

    // ç¯å¢ƒå˜é‡ï¼ˆéšè—å¯†é’¥ï¼‰
    const envItems = data.env || {};
    document.getElementById('env-config').innerHTML = `
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;">
        ${Object.entries(envItems).map(([k, v]) => `
          <div style="background:var(--bg-primary);border-radius:6px;padding:10px;">
            <div style="font-size:11px;color:var(--text-secondary);font-family:monospace;">${k}</div>
            <div style="font-size:13px;margin-top:4px;font-family:monospace;">${v}</div>
          </div>
        `).join('')}
      </div>`;

    // é£æ§è§„åˆ™
    const risk = data.risk || {};
    document.getElementById('risk-config').innerHTML = `
      <div class="grid grid-3">
        <div class="stat-card">
          <div class="stat-label">P0 ç´§æ€¥é˜ˆå€¼</div>
          <div class="stat-value" style="color:var(--accent-red);">${risk.whale_p0 || 85}</div>
          <div style="font-size:12px;color:var(--text-secondary);">å·¨é²¸è¯„åˆ† â‰¥ æ­¤å€¼è§¦å‘</div>
          <div class="progress" style="margin-top:8px;">
            <div class="progress-bar red" style="width:${risk.whale_p0 || 85}%"></div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">P1 é«˜é£é™©é˜ˆå€¼</div>
          <div class="stat-value" style="color:var(--accent-yellow);">${risk.whale_p1 || 60}</div>
          <div style="font-size:12px;color:var(--text-secondary);">å·¨é²¸è¯„åˆ† â‰¥ æ­¤å€¼å‡çº§</div>
          <div class="progress" style="margin-top:8px;">
            <div class="progress-bar yellow" style="width:${risk.whale_p1 || 60}%"></div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ³¢åŠ¨ç‡å‡çº§å€æ•°</div>
          <div class="stat-value" style="color:var(--accent-blue);">${risk.volatility_ratio || 1.5}x</div>
          <div style="font-size:12px;color:var(--text-secondary);">è¶…è¿‡æ­¤å€æ•°ä½¿ç”¨é«˜çº§æ¨¡å‹</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ç³»ç»Ÿæš‚åœé˜ˆå€¼</div>
          <div class="stat-value" style="color:var(--accent-red);">${risk.health_pause || 50}</div>
          <div style="font-size:12px;color:var(--text-secondary);">å¥åº·è¯„åˆ†ä½äºæ­¤å€¼æš‚åœ</div>
          <div class="progress" style="margin-top:8px;">
            <div class="progress-bar red" style="width:${risk.health_pause || 50}%"></div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ç³»ç»Ÿè­¦å‘Šé˜ˆå€¼</div>
          <div class="stat-value" style="color:var(--accent-yellow);">${risk.health_warn || 80}</div>
          <div style="font-size:12px;color:var(--text-secondary);">å¥åº·è¯„åˆ†ä½äºæ­¤å€¼å‘Šè­¦</div>
          <div class="progress" style="margin-top:8px;">
            <div class="progress-bar yellow" style="width:${risk.health_warn || 80}%"></div>
          </div>
        </div>
      </div>`;
  } catch(e) {
    console.error('Config load error:', e);
  }
}

async function testNotify(channel) {
  const el = document.getElementById('notify-result');
  el.style.display = 'block';
  el.innerHTML = `<div style="color:var(--text-secondary);font-size:13px;">å‘é€ä¸­...</div>`;
  try {
    const data = await apiFetch('/api/notify/test', {
      method: 'POST',
      body: JSON.stringify({ channel }),
    });
    el.innerHTML = `<div style="color:var(--accent-green);font-size:13px;">âœ… ${channel === 'dingtalk' ? 'é’‰é’‰' : 'Telegram'} æµ‹è¯•æ¶ˆæ¯å‘é€æˆåŠŸ</div>`;
  } catch(e) {
    el.innerHTML = `<div style="color:var(--accent-red);font-size:13px;">âŒ å‘é€å¤±è´¥: ${e.message}</div>`;
  }
}

loadConfig();
</script>
</body>
</html>
